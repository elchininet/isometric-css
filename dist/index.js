!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self)["isometric-css"]={})}(this,(function(t){"use strict";var e,n,a="isometric",i=+(Math.sqrt(3)/2).toFixed(6),o=Math.sqrt(1.5),r=Math.PI/3,s=Math.PI/4,c=Math.atan(Math.SQRT2),u=/(?: |,|^)(right|left|top)\s*:\s*(-?\d*?\.?\d+)(?= |,|$)/g,l=/^((ease(-in|-out|-in-out)?)|linear|(step(-start|-end)))$/;!function(t){t.top="top",t.front="front",t.side="side"}(e||(e={})),function(t){t.right="right",t.left="left",t.top="top"}(n||(n={}));var f="undefined",m=function(){return m=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},m.apply(this,arguments)};function p(t,e,n){if(n||2===arguments.length)for(var a,i=0,o=e.length;i<o;i++)!a&&i in e||(a||(a=Array.prototype.slice.call(e,0,i)),a[i]=e[i]);return t.concat(a||Array.prototype.slice.call(e))}var h=function(t){return!isNaN(+"".concat(t))},y=function(t){return t&&"string"==typeof t&&t.trim().length>0},d=function(t){return h(t)&&0!=+t},g=function(t){return void 0===t},v=function(t){return g(t)||function(t){return"boolean"==typeof t}(t)},x=function(t){return g(t)||h(t)},A=function(t){return t&&(d(t.right)||d(t.left)||d(t.top))},_=function(t){return t&&y(t.url)&&(e=t.size,g(e)||y(e))&&v(t.pixelated);var e},b=function(t){return t&&A(t.position)&&(e=t.easing,n=l,g(e)||y(e)&&n.test(e))&&x(t.duration)&&x(t.repeat)&&v(t.bounce);var e,n},k=function(t){for(var e=[];t.parentElement&&t.parentElement!==document.documentElement;){var n=t.parentElement;!n.dataset.view&&n.dataset.rotationAxis&&e.push({axis:n.dataset.rotationAxis,value:+(n.dataset.rotationValue||0)}),t=t.parentElement}return e},w=function(t){var e=t.dataset,n=e.view?e.view:null,a=+(e.right||0),i=+(e.left||0),o=+(e.top||0),r=e.rotationAxis?e.rotationAxis:null,s=+(e.rotationValue||0),c=e.texture,f=e.textureSize||"cover",m="true"===e.texturePixelated,p=k(t),y=function(t,e,n,a,i){if(t){for(var o={},r=void 0;null!==(r=u.exec(t));){var s=r[1],c=+r[2];o[s]=c}if(Object.keys(o).length){var f={position:o,repeat:a&&+a>0?+a:0,bounce:i&&"true"===i.trim()};return n&&l.test(n.trim())&&(f.easing=n.trim()),h(e)&&(f.duration=+e),f}}return null}(e.animation,e.animationDuration,e.animationEasing,e.animationRepeat,e.animationBounce),d={parentRotations:p};return n&&(d.view=n),(a||i||o)&&(d.position={right:a,left:i,top:o}),r&&s&&(d.rotation={axis:r,value:s}),c&&(d.texture={url:c,size:f,pixelated:m}),y&&(d.animation=y),d},E=function(t){return t.replace(/[A-Z]/g,"-$&").toLowerCase()},R=function(t){var e=Math.pow(10,6);return Math.round(t*e)/e},M=function(t){return t*Math.PI/180},S=function(t){return{sin:R(Math.sin(t)),cos:R(Math.cos(t))}},P=function(t,e,n){var a=Math.sqrt(Math.pow(t,2)+Math.pow(e,2)),i=Math.atan2(e,t)+M(n);return{x:Math.cos(i)*a,y:Math.sin(i)*a}},D=function(t,e){var a=t.right,o=void 0===a?0:a,r=t.left,s=void 0===r?0:r,c=t.top,u=void 0===c?0:c;e&&e.length&&p([],e,!0).reverse().forEach((function(t){switch(t.axis){case n.top:var e=P(o,s,t.value);o=e.x,s=e.y;break;case n.right:e=P(s,u,t.value);s=e.x,u=e.y;break;case n.left:e=P(u,o,t.value);u=e.x,o=e.y}}));return{x:R((o-s)*i),y:R((o+s)/2-u)}},N=function(t,e){return t.map((function(n,a){return e[0].map((function(i,o){return n.reduce((function(n,i,r){return n+t[a][r]*e[r][o]}),0)}))}))},T=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=t[0],a=1;a<t.length;a++)n=N(n,t[a]);return n},C=function(t){var e=S(t);return[[1,0,0],[0,e.cos,-e.sin],[0,e.sin,e.cos]]},O=function(t){var e=S(t);return[[e.cos,0,e.sin],[0,1,0],[-e.sin,0,e.cos]]},j=function(t){var e=S(t);return[[e.cos,-e.sin,0],[e.sin,e.cos,0],[0,0,1]]},I=T(C(c),j(-s)),K=T(j(-r),C(c),j(s)),z=T(j(r),C(c),j(-s)),L=function(t,a){var i=M(a.value);switch(t){case e.top:switch(a.axis){case n.top:return j(i);case n.left:return C(-i);case n.right:return O(i);default:return null}case e.front:switch(a.axis){case n.top:return O(i);case n.left:return C(i);case n.right:return j(i);default:return null}case e.side:switch(a.axis){case n.top:return O(i);case n.left:return j(i);case n.right:return C(-i);default:return null}default:return null}},V=function(){function t(){this._globalStyle=null,this._style=null,this.scale=R(o),this.P50="50%",this.transformBefore="translate(-".concat(this.P50,", -").concat(this.P50,")"),this.tranformAfterTop="translate(-".concat(this.P50,", ").concat(this.P50,")"),this.transformAfterFront="translate(-".concat(this.P50,", -").concat(this.P50,")"),this.transformAfterSide="translate(".concat(this.P50,", -").concat(this.P50,")"),this.baseDeclarations={position:"absolute"},this.transformOriginDeclarations={transformOrigin:"".concat(this.P50," ").concat(this.P50),MsTransformOrigin:"".concat(this.P50," ").concat(this.P50),WebkitTransformOrigin:"".concat(this.P50," ").concat(this.P50)}}return Object.defineProperty(t.prototype,"sheet",{get:function(){return this._style?this._style.sheet:null},enumerable:!1,configurable:!0}),t.prototype.getTransform=function(t,n,a){var i=function(t,n,a){var i=[];n.forEach((function(e){var n=L(t,e);n&&i.push(n)}));var o=a?L(t,a):null;switch(o&&i.push(o),t){case e.top:return T.apply(void 0,p([I],i,!1));case e.front:return T.apply(void 0,p([K],i,!1));case e.side:return T.apply(void 0,p([z],i,!1))}return null}(t,n,a);if(!i)return null;var o=R(i[0][0]),r=R(i[1][0]),s=R(i[0][1]),c=R(i[1][1]),u="matrix(".concat(o,",").concat(r,",").concat(s,",").concat(c,",0,0)"),l="".concat(this.transformBefore," ").concat(u," scale(").concat(this.scale,")");switch(t){case e.top:return"".concat(l," ").concat(this.tranformAfterTop);case e.front:return"".concat(l," ").concat(this.transformAfterFront);case e.side:return"".concat(l," ").concat(this.transformAfterSide)}},t.prototype.insertGlobalStyles=function(){this._globalStyle.sheet.insertRule('[data-animation][data-animation-running="false"] {\n                animation-play-state: paused;\n            }')},t.prototype.init=function(){var t=document.getElementsByTagName("head")[0];this._globalStyle=document.createElement("style"),this._style=document.createElement("style"),this._globalStyle.dataset.isometricGlobal="",this._style.dataset.isometric="",t.appendChild(this._globalStyle),t.appendChild(this._style),this.insertGlobalStyles()},t.prototype.getKeyframes=function(t){if(t.animation){var e=t.position||{right:0,left:0,top:0},n=D(e,t.parentRotations),a=D(m(m({},e),t.animation.position),t.parentRotations);return{from:{left:"".concat(n.x,"px"),top:"".concat(n.y,"px")},to:{left:"".concat(a.x,"px"),top:"".concat(a.y,"px")}}}return null},t.prototype.getRule=function(t,e){var n=this.getTransform(t.view,t.parentRotations,t.rotation),a=n?m(m(m({},this.baseDeclarations),this.transformOriginDeclarations),{transform:n,MsTransform:n,WebkitTransform:n}):t.position||t.texture||t.animation&&e?m({},this.baseDeclarations):{};if(t.position){var i=D(t.position,t.parentRotations);a.left="".concat(i.x,"px"),a.top="".concat(i.y,"px")}return t.texture&&(a.backgroundImage='url("'.concat(t.texture.url,'")'),a.backgroundSize=t.texture.size||"cover",t.texture.pixelated&&(a.MsInterpolationMode="nearest-neighbor",a.imageRendering="pixelated",a.fallbacks=[{imageRendering:"crisp-edges"}])),t.animation&&e&&(a.animationName=e,a.animationDuration=t.animation.duration?"".concat(t.animation.duration,"ms"):"1000ms",a.animationTimingFunction=t.animation.easing||"linear",a.animationIterationCount=t.animation.repeat?t.animation.bounce?"".concat(2*t.animation.repeat):"".concat(t.animation.repeat):"infinite",a.animationDirection=t.animation.bounce?"alternate":"normal",a.animationFillMode="both"),a},t.prototype.getDeclarationString=function(t){var e=this;return Object.entries(t).reduce((function(t,n){if(Array.isArray(n[1])){var a=n[1].map((function(t){return e.getDeclarationString(t)})).join("\n");return"".concat(t).concat(a)}return"object"==typeof n[1]?"".concat(t,"\n").concat(E(n[0])," {").concat(e.getDeclarationString(n[1]),"\n}"):"".concat(t,"\n    ").concat(E(n[0]),": ").concat(n[1],";")}),"")},t.prototype.getSelector=function(t){return"".concat(a,"-").concat(function(t){for(var e,n=0,a=0,i=t.length;i>=4;++a,i-=4)e=1540483477*(65535&(e=255&t.charCodeAt(a)|(255&t.charCodeAt(++a))<<8|(255&t.charCodeAt(++a))<<16|(255&t.charCodeAt(++a))<<24))+(59797*(e>>>16)<<16),n=1540483477*(65535&(e^=e>>>24))+(59797*(e>>>16)<<16)^1540483477*(65535&n)+(59797*(n>>>16)<<16);switch(i){case 3:n^=(255&t.charCodeAt(a+2))<<16;case 2:n^=(255&t.charCodeAt(a+1))<<8;case 1:n=1540483477*(65535&(n^=255&t.charCodeAt(a)))+(59797*(n>>>16)<<16)}return(((n=1540483477*(65535&(n^=n>>>13))+(59797*(n>>>16)<<16))^n>>>15)>>>0).toString(36)}(t))},t.prototype.getRuleData=function(t){var e=this.getKeyframes(t),n=e?this.getDeclarationString(e):null,a=n?this.getSelector(n):null,i=this.getRule(t,a);if(Object.keys(i).length){var o=this.getDeclarationString(i),r={rule:i,declaration:o,selector:this.getSelector(o)};return e&&(r.keyframes=e,r.keyframesDeclaration=n,r.keyframesName=a),r}return null},t.prototype.insert=function(t,e){this.sheet||this.init(),this.sheet.insertRule(".".concat(t," {\n").concat(e,"\n}"))},t.prototype.insertKeyframes=function(t,e){this.sheet.insertRule("@keyframes ".concat(t," {\n").concat(e,"\n}"))},t.prototype.remove=function(t){var e=this;Array.prototype.some.call(this.sheet.cssRules,(function(n,a){return("name"in n&&n.name===t||"selectorText"in n&&n.selectorText.slice(1)===t)&&(e.sheet.deleteRule(a),!0)}))},t}(),B=new(function(){function t(){this._elements=new Map,this._classes=new Map,this._keyframes=new Map,this._styles=new V}return t.prototype.hasAnimation=function(t){var e=this._elements.get(t);return!(!e||!e.keyframesName)},t.prototype.removeClasses=function(t,e){t.classList.remove(e);var n=this._classes.get(e),a=n.findIndex((function(e){return e===t}));n.splice(a,1),0===n.length&&(this._classes.delete(e),this._styles.remove(e))},t.prototype.removeKeyframes=function(t,e){var n=this._keyframes.get(e),a=n.findIndex((function(e){return e===t}));n.splice(a,1),0===n.length&&(this._keyframes.delete(e),this._styles.remove(e))},t.prototype.process=function(t,e){var n=this._elements.get(t),a=this._styles.getRuleData(e);if(a){var i={plane:e,selector:a.selector,rule:a.rule};if(n){if(n.selector===a.selector&&n.keyframesName===a.keyframesName)return;this.removeClasses(t,n.selector),n.keyframesName&&this.removeKeyframes(t,n.keyframesName)}t.classList.add(a.selector);var o=this._classes.get(a.selector);if(o?o.push(t):(this._styles.insert(a.selector,a.declaration),this._classes.set(a.selector,[t])),a.keyframesName&&a.keyframesDeclaration){var r=this._keyframes.get(a.keyframesName);r?r.push(t):(this._styles.insertKeyframes(a.keyframesName,a.keyframesDeclaration),this._keyframes.set(a.keyframesName,[t])),i.keyframes=a.keyframes,i.keyframesName=a.keyframesName}this._elements.set(t,i)}},t.prototype.addElement=function(t){var e=w(t);this.process(t,e)},t.prototype.removeElement=function(t){!function(t){t.classList.remove(a),function(t,e){["view","right","left","top","rotationAxis","rotationValue","texture","textureSize","texturePixelated","animation","animationDuration","animationEasing","animationRepeat","animationBounce","animationRunning"].forEach((function(e){t.dataset[e]&&delete t.dataset[e]}))}(t)}(t);var e=this._elements.get(t);e&&(this._elements.delete(t),this.removeClasses(t,e.selector),e.keyframesName&&this.removeKeyframes(t,e.keyframesName))},t.prototype.setElementView=function(t,n){if(function(t){return t&&(t===e.top||t===e.front||t===e.side)}(n)){var a=this._elements.get(t);this.process(t,a?m(m({},a.plane),{view:n}):{view:n,parentRotations:k(t)})}},t.prototype.setElementPosition=function(t,e){if(A(e)){var n=this._elements.get(t);this.process(t,n?m(m({},n.plane),{position:m(m({},n.plane.position),e)}):{position:e,parentRotations:k(t)})}},t.prototype.setElementRotation=function(t,e){if(function(t){return t&&h(t.value)&&(t.axis===n.right||t.axis===n.left||t.axis===n.top)}(e)){var a=this._elements.get(t);this.process(t,a?m(m({},a.plane),{rotation:e}):{rotation:e,parentRotations:k(t)})}},t.prototype.setElementTexture=function(t,e){if(_(e)){var n=this._elements.get(t);this.process(t,n?m(m({},n.plane),{texture:m(m({},n.plane.texture),e)}):{texture:e,parentRotations:k(t)})}},t.prototype.setElementAnimation=function(t,e){if(b(e)){var n=this._elements.get(t);this.process(t,n?m(m({},n.plane),{animation:n.plane.animation?m(m({},n.plane.animation),e):e}):{animation:e,parentRotations:k(t)})}},t.prototype.resetAnimation=function(t){if(this.hasAnimation(t)){var e=t.className;t.className="",t.offsetWidth,t.className=e}},t.prototype.pauseAnimation=function(t){this.hasAnimation(t)&&(t.dataset.animationRunning="false")},t.prototype.resumeAnimation=function(t){this.hasAnimation(t)&&(t.dataset.animationRunning="true")},t}()),F={processDOM:function(){Array.prototype.forEach.call(document.querySelectorAll(".".concat(a)),(function(t){B.addElement(t)}))},processElement:function(t){B.addElement(t)},resetElement:function(t){B.removeElement(t)},setView:function(t,e){B.setElementView(t,e)},setRotation:function(t,e){B.setElementRotation(t,e)},setPosition:function(t,e){B.setElementPosition(t,e)},setTexture:function(t,e){B.setElementTexture(t,e)},setAnimation:function(t,e){B.setElementAnimation(t,e)},resetAnimation:function(t){B.resetAnimation(t)},pauseAnimation:function(t){B.pauseAnimation(t)},resumeAnimation:function(t){B.resumeAnimation(t)}};typeof window!==f&&typeof document!==f&&(window.IsometricCSS=F,window.addEventListener("DOMContentLoaded",(function(){F.processDOM()}))),t.IsometricCSS=F,Object.defineProperty(t,"__esModule",{value:!0})}));
